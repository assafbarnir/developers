<p>Restrict access to an API by whitelisting or blacklisting consumers using arbitrary ACL group names. This plugin requires an <a href="/about/faq/#how-can-i-add-authentication-to-a-microservice-api">authentication plugin</a> to have been already enabled on the API.</p>

<hr />

<h2 id="configuration">Configuration</h2>

<p>Configuring the plugin is straightforward, you can add it on top of an <a href="/docs/latest/admin-api/#api-object">API</a> by executing the following request on your Qordoba server:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -X POST http://qordoba:8001/apis/<span class="o">{</span>api<span class="o">}</span>/plugins <span class="se">\</span>
    --data <span class="s2">"name=acl"</span> <span class="se">\</span>
    --data <span class="s2">"config.whitelist=group1, group2"</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">api</code>: The <code class="highlighter-rouge">id</code> or <code class="highlighter-rouge">name</code> of the API that this plugin configuration will target</p>

<p>You can also apply it for every API using the <code class="highlighter-rouge">http://qordoba:8001/plugins/</code> endpoint. Read the <a href="/docs/latest/admin-api/#add-plugin">Plugin Reference</a> for more information.</p>

<table>
  <thead>
    <tr>
      <th>form parameter</th>
      <th>default</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">name</code></td>
      <td> </td>
      <td>The name of the plugin to use, in this case: <code class="highlighter-rouge">acl</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">config.whitelist</code><br /><em>semi-optional</em></td>
      <td> </td>
      <td>Comma separated list of arbitrary group names that are allowed to consume the API. One of <code class="highlighter-rouge">config.whitelist</code> or <code class="highlighter-rouge">config.blacklist</code> must be specified.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">config.blacklist</code><br /><em>semi-optional</em></td>
      <td> </td>
      <td>Comma separated list of arbitrary group names that are not allowed to consume the API. One of <code class="highlighter-rouge">config.whitelist</code> or <code class="highlighter-rouge">config.blacklist</code> must be specified.</td>
    </tr>
  </tbody>
</table>

<p>Note that the <code class="highlighter-rouge">whitelist</code> and <code class="highlighter-rouge">blacklist</code> models are mutually exclusive in their usage, as they provide complimentary approaches. That is, you cannot configure an ACL with both <code class="highlighter-rouge">whitelist</code> and <code class="highlighter-rouge">blacklist</code> configurations. An ACL with a <code class="highlighter-rouge">whitelist</code> provides a positive security model, in which the configured groups are allowed access to the resources, and all others are inherently rejected. By contrast, a <code class="highlighter-rouge">blacklist</code> configuration provides a negative security model, in which certain groups are explicitly denied access to the resource (and all others are inherently allowed).</p>

<hr />

<h2 id="usage">Usage</h2>

<p>In order to use this plugin, you need to properly have configured your APIs with an <a href="/about/faq/#how-can-i-add-authentication-to-a-microservice-api">authentication plugin</a> so that the plugin can identify who is the client <a href="/docs/latest/admin-api/#consumer-object">Consumer</a> making the request.</p>

<h3 id="associating-consumers">Associating Consumers</h3>

<p>Once you have added an authentication plugin to an API, and you have created your <a href="/docs/latest/admin-api/#consumer-object">Consumers</a>, you can now associate a group to a <a href="/docs/latest/admin-api/#consumer-object">Consumer</a> using the following request:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -X POST http://qordoba:8001/consumers/<span class="o">{</span>consumer<span class="o">}</span>/acls <span class="se">\</span>
    --data <span class="s2">"group=group1"</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">consumer</code>: The <code class="highlighter-rouge">id</code> or <code class="highlighter-rouge">username</code> property of the <a href="/docs/latest/admin-api/#consumer-object">Consumer</a> entity to associate the credentials to.</p>

<table>
  <thead>
    <tr>
      <th>form parameter</th>
      <th>default</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">group</code></td>
      <td> </td>
      <td>The arbitrary group name to associate to the consumer.</td>
    </tr>
  </tbody>
</table>

<p>You can have more than one group associated to a consumer.</p>

<h3 id="upstream-headers">Upstream Headers</h3>

<p>When a consumer has been validated, the plugin will append a <code class="highlighter-rouge">X-Consumer-Groups</code> header to the request before proxying it to the upstream API/Microservice, so that you can identify the groups associated with the consumer. The value of the header is a comma separated list of groups that belong to the consumer, like <code class="highlighter-rouge">admin, pro_user</code>.</p>

<h3 id="paginate-through-the-acls">Paginate through the ACLs</h3>

<div class="alert alert-warning">
  <strong>Note:</strong> This endpoint was introduced in Qordoba 0.11.2.
</div>

<p>You can retrieve all the ACLs for all Consumers using the following
request:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -X GET http://qordoba:8001/acls

<span class="o">{</span>
    <span class="s2">"total"</span>: 3,
    <span class="s2">"data"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"group"</span>: <span class="s2">"foo-group"</span>,
            <span class="s2">"created_at"</span>: 1511391159000,
            <span class="s2">"id"</span>: <span class="s2">"724d1be7-c39e-443d-bf36-41db17452c75"</span>,
            <span class="s2">"consumer_id"</span>: <span class="s2">"89a41fef-3b40-4bb0-b5af-33da57a7ffcf"</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"group"</span>: <span class="s2">"bar-group"</span>,
            <span class="s2">"created_at"</span>: 1511391162000,
            <span class="s2">"id"</span>: <span class="s2">"0905f68e-fee3-4ecb-965c-fcf6912bf29e"</span>,
            <span class="s2">"consumer_id"</span>: <span class="s2">"c0d92ba9-8306-482a-b60d-0cfdd2f0e880"</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"group"</span>: <span class="s2">"baz-group"</span>,
            <span class="s2">"created_at"</span>: 1509814006000,
            <span class="s2">"id"</span>: <span class="s2">"ff883d4b-aee7-45a8-a17b-8c074ba173bd"</span>,
            <span class="s2">"consumer_id"</span>: <span class="s2">"c0d92ba9-8306-482a-b60d-0cfdd2f0e880"</span>
        <span class="o">}</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre>
</div>

<p>You can filter the list using the following query parameters:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Attributes</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code class="highlighter-rouge">id</code><br /><em>optional</em></td>
      <td>A filter on the list based on the ACL <code class="highlighter-rouge">id</code> field.</td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="highlighter-rouge">group</code><br /><em>optional</em></td>
      <td>A filter on the list based on the ACL <code class="highlighter-rouge">group</code> field.</td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="highlighter-rouge">consumer_id</code><br /><em>optional</em></td>
      <td>A filter on the list based on the ACL <code class="highlighter-rouge">consumer_id</code> field.</td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="highlighter-rouge">size</code><br /><em>optional, default is <strong>100</strong></em></td>
      <td>A limit on the number of objects to be returned.</td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="highlighter-rouge">offset</code><br /><em>optional</em></td>
      <td>A cursor used for pagination. <code class="highlighter-rouge">offset</code> is an object identifier that defines a place in the list.</td>
    </tr>
  </tbody>
</table>

<h3 id="retrieve-the-consumer-associated-with-an-acl">Retrieve the Consumer associated with an ACL</h3>

<div class="alert alert-warning">
  <strong>Note:</strong> This endpoint was introduced in Qordoba 0.11.2.
</div>

<p>It is possible to retrieve a <a href="/docs/latest/admin-api/#consumer-object">Consumer</a> associated with an ACL
using the following request:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>curl -X GET http://qordoba:8001/acls/<span class="o">{</span>id<span class="o">}</span>/consumer

<span class="o">{</span>
   <span class="s2">"created_at"</span>:1507936639000,
   <span class="s2">"username"</span>:<span class="s2">"foo"</span>,
   <span class="s2">"id"</span>:<span class="s2">"c0d92ba9-8306-482a-b60d-0cfdd2f0e880"</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">id</code>: The <code class="highlighter-rouge">id</code> property of the ACL for which to get the associated
<a href="/docs/latest/admin-api/#consumer-object">Consumer</a>.</p>

